<html>
<head>
    <title>Other Tests</title>
    <link rel="stylesheet" type="text/css" href="CSS/p1_style.css" />



    <script>
          function zeroize(value, length) {
                if (!length) length = 2;
                value = String(value);
                for (var i = 0, zeros = ''; i < (length - value.length); i++) {
                    zeros += '0';
                }
                return zeros + value;
          };

        $(document).ready(function (e) {
                sqldata.GetLoginData(callback_GetLoginData);
        });
        var WorksGoodList ;
        function callback_GetLoginData(data) {
            var uid=data.rows.item(0).uid;
            var PostData="uid="+uid+"&page="+"1"+"&max="+"50";
            ServerRuqest.works_good_list(PostData,function (x) {
                WorksGoodList = JSON.parse(x);
                if(WorksGoodList.result==="1")
                {
                   // var ddiv=document.getElementById("flex-item")
                    for (var i = 0; i < WorksGoodList.data.length; i++) {

                        var dur=Number(WorksGoodList.data[i].duration);
                        var newTime = new Date(dur);
                        var time=zeroize(newTime.getMinutes())+":"+zeroize(newTime.getSeconds());

                         $("#testBody2").append(
                                "<div id='video_item'>" +
                                    "<div id='video_item_head' style='background-image: url("+WorksGoodList.data[i].screenshot_s +")'>"+
                                        "<div id='video_item_head_img'  >"+
                                    "</div>"+
                                    "<div id='video_item_info'  onclick='ClickComment(" + i + "," + JSON.stringify(WorksGoodList.data[i])+");'>"+
                                        "<a id='test2' href='#comment_view'></a>"+
                                        "<p id='video_item_info_title'>"+WorksGoodList.data[i].title +"</p>"+
                                        "<p id='video_item_info_time'>"+time +"</p>"+
                                    "</div>"+
                                "</div>");
 /*                       $("#testBody2").prepend("" +
                                "<div class=\"flex-item\">" +
                                    "<a href=\"  " + WorksGoodList.data[i].downurl + "\" >播放</a> " +
                                    "<img class=\"item-screenshot\" src=\" "+WorksGoodList.data[i].screenshot_s+" \">"+
                                    "<input value=\"提交\" type=\"button\" onclick=\"palyMP4();\" /> " +
                                "</div>");*/
                    }
                }
            },function () {

            });

        }

        function ClickComment(index,data) {
            currVideoData=data;
            var obj=document.getElementById('comment_view');
            if(obj.style.display==="")
            {
                runComment(data);
                obj.style.animation="openComment_view 0.3s forwards";
                obj.style.display="block";
                return;
            }
            if(obj.style.display==="block")
            {
                obj.style.animation="ResetComment_view 0.2s forwards";
                function tttt() {
                    obj.removeEventListener('animationend', tttt);
                    runComment(data);
                    obj.style.animation="ResetComment_view2 0.2s forwards";
                }
                obj.addEventListener("animationend", tttt);

            }

        }
        var currVideoData;
        function runComment(data) {
          //  alert("runComment");
          $('#commnet_content_write_title').html(data.title);
            var PostData="vid="+data.vid+"&page="+"1"+"&max="+"50";

            var CommentList;
               ServerRuqest.comment_list(PostData, function (x) {
                        CommentList = JSON.parse(x);
                            if(CommentList.result==="1") {
                              //  alert(CommentList.data.length);
                                $("#commnet_content_read").empty();
                                for (var i = 0; i < CommentList.data.length; i++) {
                                    $("#commnet_content_read").append(
                                            "<div id='commnet_list_data'>" +
                                                "<img src='" + CommentList.data[i].head+ "'>" +"&nbsp;&nbsp;"+
                                                    "<p>"+"&nbsp;&nbsp;"+"</p>"+
                                                "<p id='commnet_list_data_nickname'>"+ CommentList.data[i].nickname+"&nbsp;&nbsp;"+"</p>"+

                                                "<p>"+ CommentList.data[i].addtime+"&nbsp;&nbsp;"+"</p>"+
                                                "<p>"+ CommentList.data[i].content+"</p>"+

                                            "</div>"+"<hr id='commnet_list_hr'/>"

                                    );
                                }
                            }
                            if(CommentList.result==="1009"){
                                $("#commnet_content_read").empty();
                            }
                    }
                    ,function () {

                    });

        }
        function SendComment() {

            var text = $('#commnet_content_write_intext').val();
            if(text==="")return;
            var PostData="uid="+currVideoData.uid+"&vid="+currVideoData.vid+"&content="+text;

            ServerRuqest.works_comments(PostData,function (x) {
               var Rus = JSON.parse(x);
                if(Rus.result==="1") {
                    alert("runComment=3");
                    runComment(currVideoData);

                }
            },function () {

            });

        }

        function tologin() {
            alert(msg);
            var obj = JSON.parse(msg);
            alert(obj.result);
        }

        function palyMP4()
        {
            send_message('PlayMP4');
          }
        function runJPKC() {
            $("#JPKC").css("color", "#3089CE");
            $("#SSFX").css("color", "#99A7AF");

        }y
        function runSSFX() {
            $("#SSFX").css("color", "#3089CE");
            $("#JPKC").css("color", "#99A7AF");
        }
 
    </script>
</head>
<body>


    <div id="nbody">
        <div id="HeadBody">
            <a id="JPKC" onclick="runJPKC();">精品课程</a>
            <a id="SSFX" onclick="runSSFX();">师生分享</a>
        </div>
        <div id="testBody">
            <div id="testBody2">

            </div>
        </div>
        <div id="comment_view">
            <div id="commnet_content">
                <div id="commnet_content_write">
                    <p id="commnet_content_write_title">评论区</p>
                    <input id="commnet_content_write_intext"  type="text" placeholder="写评论"/>
                    <input  type="button" value="提交" onclick="SendComment();"/>
                </div>
                <div id="commnet_content_read">

                </div>

            </div>

        </div>
        
    </div>


</body>
 
</html>
